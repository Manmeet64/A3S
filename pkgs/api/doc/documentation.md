<!-- markdownlint-disable MD024 MD025 -->

# A3s API Documentation

> Version: 1

## authn

### MTLSSource

An MTLS Auth source can be used to issue tokens based on user certificates.

#### Example

```json
{
  "certificateAuthority": "-----BEGIN CERTIFICATE-----
MIIBZTCCAQugAwIBAgIRANYvXLTa16Ykvc9hQ4BBLJEwCgYIKoZIzj0EAwIwEjEQ
MA4GA1UEAxMHQUNNRSBDQTAeFw0yMTExMDEyMzAwMTlaFw0zMTA5MTAyMzAwMTla
MBIxEDAOBgNVBAMTB0FDTUUgQ0EwWTATBgcqhkjOPQIBBggqhkjOPQMBBwNCAASa
7wknroxwB1znupZ67NzTG9Kuc+tNRlbI22eTDNMKYpIexzWDOyiQ95N3GQIdmAz5
wVu9l2V3VuKUpD9mNgkRo0IwQDAOBgNVHQ8BAf8EBAMCAQYwDwYDVR0TAQH/BAUw
AwEB/zAdBgNVHQ4EFgQURIT2kL76vMj9A3r9AUnaiHnHf4EwCgYIKoZIzj0EAwID
SAAwRQIgS4SGaJ/B1Ul88Jal11Q5BwiY9bY2y9w+4xPNBxSyAIcCIQCSWVq+00xS
bOmROq+EsxO4L/GzJx7MBbeJ6x142VKSBQ==
-----END CERTIFICATE-----",
  "name": "mypki"
}
```

#### Relations

##### `GET /mtlssources`

Retrieves the list of mtlssources.

##### `POST /mtlssources`

Creates a new mtlssource.

##### `DELETE /mtlssources/:id`

Delete a particular mtlssource object.

##### `GET /mtlssources/:id`

Get a particular mtlssource object.

##### `PUT /mtlssources/:id`

Update a particular mtlssource object.

#### Attributes

##### `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

ID is the identifier of the object.

##### `certificateAuthority` [`required`]

Type: `string`

The Certificate authority to use to validate user certificates in PEM format.

##### `description`

Type: `string`

The description of the object.

##### `name` [`required`]

Type: `string`

The name of the source.

##### `namespace` [`autogenerated`,`read_only`]

Type: `string`

The namespace of the object.

## authz

### Permissions

API to retrieve the permissions from a user identity.

#### Example

```json
{
  "claims": [
    "sourcetype=mtls",
    "sourcename=my-source",
    "sourcenamespace=/my/namespace",
    "color=blue",
    "size=big"
  ],
  "restrictedNamespace": "/namespace",
  "restrictedNetworks": [
    "10.0.0.0/8"
  ],
  "restrictedPermissions": [
    "@auth:role=enforcer"
  ],
  "targetNamespace": "/acme"
}
```

#### Relations

##### `POST /permissions`

Sends a permissions request.

#### Attributes

##### `claims` [`required`]

Type: `[]string`

The list of claims.

##### `clientIP`

Type: `string`

IP of the client.

##### `error` [`autogenerated`,`read_only`]

Type: `string`

Return an eventual error.

##### `permissions` [`autogenerated`,`read_only`]

Type: `map[string]map[string]bool`

The computed permissions.

##### `restrictedNamespace`

Type: `string`

Sets the namespace restrictions that should apply.

##### `restrictedNetworks`

Type: `[]string`

Sets the networks restrictions that should apply.

##### `restrictedPermissions`

Type: `[]string`

Sets the permissions restrictions that should apply.

##### `targetID`

Type: `string`

The optional ID of the object to check permission for.

##### `targetNamespace` [`required`]

Type: `string`

The namespace where to check permission from.

## core

### Issue

Issues a new a normalized token using various authentication sources.

#### Example

```json
{
  "restrictedNamespace": "/namespace",
  "restrictedNetworks": [
    "10.0.0.0/8",
    "127.0.0.1/32"
  ],
  "restrictedPermissions": [
    "dogs,post"
  ],
  "sourceName": "/my/ns",
  "sourceNamespace": "/my/ns",
  "sourceType": "OIDC",
  "validity": "24h"
}
```

#### Relations

##### `POST /issue`

Ask to issue a new authentication token.

Parameters:

- `asCookie` (`boolean`): If set to true, the token will be delivered in a secure cookie, and not in the response body.

#### Attributes

##### `metadata`

Type: `map[string]interface{}`

Contains various additional information. Meaning depends on the `source`.

##### `opaque`

Type: `map[string]string`

Opaque data that will be included in the issued token.

##### `restrictedNamespace`

Type: `string`

Restricts the namespace where the token can be used.

For instance, if you have have access to `/namespace` and below, you can
tell the policy engine that it should restrict further more to
`/namespace/child`.

Restricting to a namespace you don't have initially access according to the
policy engine has no effect and may end up making the token unusable.

##### `restrictedNetworks`

Type: `[]string`

Restricts the networks from where the token can be used. This will reduce the
existing set of authorized networks that normally apply to the token according
to the policy engine.

For instance, If you have authorized access from `0.0.0.0/0` (by default) or
from
`10.0.0.0/8`, you can ask for a token that will only be valid if used from
`10.1.0.0/16`.

Restricting to a network that is not initially authorized by the policy
engine has no effect and may end up making the token unusable.

##### `restrictedPermissions`

Type: `[]string`

Restricts the permissions of token. This will reduce the existing permissions
that normally apply to the token according to the policy engine.

For instance, if you have administrative role, you can ask for a token that will
tell the policy engine to reduce the permission it would have granted to what is
given defined in the token.

Restricting to some permissions you don't initially have according to the policy
engine has no effect and may end up making the token unusable.

##### `sourceName`

Type: `string`

The name of the source to use.

##### `sourceNamespace`

Type: `string`

The namespace of the source to use.

##### `sourceType` [`required`]

Type: `enum(AWSSecurityToken | MTLS | LDAP | GCPIdentityToken | AzureIdentityToken | OIDC | SAML | A3SIdentityToken)`

The authentication source. This will define how to verify
credentials from internal or external source of authentication.

##### `token` [`autogenerated`,`read_only`]

Type: `string`

Issued token.

##### `validity`

Type: `string`

Configures the maximum length of validity for a token, using
[Golang duration syntax](https://golang.org/pkg/time/#example_Duration). If it
is bigger than the configured max validity, it will be capped. Default: `24h`.

Default value:

```json
"24h"
```

## policy

### Authorization

TODO.

#### Example

```json
{
  "disabled": false,
  "hidden": false,
  "name": "my authorization",
  "permissions": [
    "@auth:role=namespace.administrator",
    "namespace,get,post,put",
    "authorization,get:1234567890"
  ],
  "targetNamespace": "/my/namespace"
}
```

#### Relations

##### `GET /authorizations`

Retrieves the list of authorization.

##### `POST /authorizations`

Creates a new authorization.

##### `DELETE /authorizations/:id`

Deletes the authorization with the given ID.

Parameters:

- `q` (`string`): This is an example.

##### `GET /authorizations/:id`

Retrieves the authorization with the given ID.

##### `PUT /authorizations/:id`

Updates the authorization with the given ID.

#### Attributes

##### `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

ID is the identifier of the object.

##### `description`

Type: `string`

Description of the Authorization.

##### `disabled`

Type: `boolean`

Set the authorization to be disabled.

##### `hidden`

Type: `boolean`

Hides the policies in children namespaces.

##### `name` [`required`]

Type: `string`

The name of the Authorization.

##### `namespace` [`autogenerated`,`read_only`]

Type: `string`

The namespace of the object.

##### `permissions` [`required`]

Type: `[]string`

A list of permissions.

##### `subject`

Type: `[][]string`

A tag expression that identifies the authorized user(s).

##### `subnets`

Type: `[]string`

If set, the API authorization will only be valid if the request comes from one
the declared subnets.

##### `targetNamespace` [`required`]

Type: `string`

Defines the namespace or namespaces in which the permission for subject should
apply.

### Namespace

A namespace is grouping object. Every object is part of a namespace, and every
request is made against a namespace. Namespaces form a tree hierarchy.

#### Example

```json
{
  "name": "mycompany"
}
```

#### Relations

##### `GET /namespaces`

Retrieves the list of namespaces.

##### `POST /namespaces`

Creates a new namespace.

##### `DELETE /namespaces/:id`

Delete a particular namespace object.

##### `GET /namespaces/:id`

Get a particular namespace object.

##### `PUT /namespaces/:id`

Update a particular namespace object.

#### Attributes

##### `ID` [`identifier`,`autogenerated`,`read_only`]

Type: `string`

ID is the identifier of the object.

##### `description`

Type: `string`

The description of the object.

##### `name` [`required`,`creation_only`,`format=^[a-zA-Z0-9_/]+$`]

Type: `string`

The name of the namespace. When you create a namespace, only put its bare name,
not its full path.

##### `namespace` [`autogenerated`,`read_only`]

Type: `string`

The namespace of the object.
